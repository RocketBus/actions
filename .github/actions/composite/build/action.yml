name: 'Build'
description: 'Build Artifact'

inputs:
  buildpacks:
    description: ''
    required: false
  aws_access_key_id:
    description: ''
    required: false
  aws_secret_access_key:
    description: ''
    required: false
  codeartifact_domain_owner:
    description: ''
    required: false
  codeartifact_domain:
    description: ''
    required: false
  yarnrc:
    description: ''
    required: false
  npmrc:
    description: ''
    required: false
  maven_settings:
    description: ''
    required: false
  artifact_path:
    description: ''
    required: false

runs:
  using: "composite"
  steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Set up .NET cli
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '6.0.x'
      env:
        DOTNET_INSTALL_DIR: ~/.local/share/dotnet

    - name: Set up GitVersion
      uses: gittools/actions/gitversion/setup@v0
      with:
        versionSpec: '5.x'

    - name: Determine Version
      id: gitversion
      uses: gittools/actions/gitversion/execute@v0

    - name: Set up Buildpack
      uses: RocketBus/actions/.github/actions/utils/buildpack@v1
      with:
        buildpacks: ${{ inputs.buildpacks }}

    - name: Build Node.js
      if: ${{ contains(fromJSON(inputs.buildpacks), 'nodejs') }}
      uses: RocketBus/actions/.github/actions/nodejs/build@v1
      with:
        aws_access_key_id: ${{ inputs.aws_access_key_id }}
        aws_secret_access_key: ${{ inputs.aws_secret_access_key }}
        codeartifact_domain_owner: ${{ inputs.codeartifact_domain_owner }}
        codeartifact_domain: ${{ inputs.codeartifact_domain }}
        yarnrc: ${{ inputs.yarnrc }}
        npmrc: ${{ inputs.npmrc }}
        artifact_path: ${{ inputs.artifact_path }}

    - name: Build Java
      if: ${{ contains(fromJSON(inputs.buildpacks), 'java') }}
      uses: RocketBus/actions/.github/actions/java/build@v1
      with:
        aws_access_key_id: ${{ inputs.aws_access_key_id }}
        aws_secret_access_key: ${{ inputs.aws_secret_access_key }}
        codeartifact_domain_owner: ${{ inputs.codeartifact_domain_owner }}
        codeartifact_domain: ${{ inputs.codeartifact_domain }}
        maven_settings: ${{ inputs.maven_settings }}
        artifact_path: ${{ inputs.artifact_path }}

    - name: Build Gradle
      if: ${{ contains(fromJSON(inputs.buildpacks), 'gradle') }}
      uses: RocketBus/actions/.github/actions/gradle/build@v1
      with:
        aws_access_key_id: ${{ inputs.aws_access_key_id }}
        aws_secret_access_key: ${{ inputs.aws_secret_access_key }}
        codeartifact_domain_owner: ${{ inputs.codeartifact_domain_owner }}
        codeartifact_domain: ${{ inputs.codeartifact_domain }}
        artifact_path: ${{ inputs.artifact_path }}

    - name: Build Docker
      if: ${{ contains(fromJSON(inputs.buildpacks), 'docker') }}
      uses: RocketBus/actions/.github/actions/docker/build@v1
      with:
        aws_access_key_id: ${{ inputs.aws_access_key_id }}
        aws_secret_access_key: ${{ inputs.aws_secret_access_key }}

    - name: Build Helm
      if: ${{ contains(fromJSON(inputs.buildpacks), 'helm') }}
      uses: RocketBus/actions/.github/actions/helm/build@v1
      with:
        aws_access_key_id: ${{ inputs.aws_access_key_id }}
        aws_secret_access_key: ${{ inputs.aws_secret_access_key }}